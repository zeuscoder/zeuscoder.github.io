<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  
  
  
  <meta name="description" content="穷则独善其身">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    WEB：不起眼的 Webpack |
    
    zeus の blog</title>
  
  <link rel="shortcut icon" href="/zeus.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 7.2.0"></head>

<body>
  <main class="content">
    <section class="outer">
  <article id="post-web-webpack" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      

<h1 class="article-title" itemprop="name">
  WEB：不起眼的 Webpack
</h1>



    </header>
    

    
    <div class="article-meta">
      <a href="/2020/03/08/web-webpack/" class="article-date">
  <time datetime="2020-03-08T07:34:50.000Z" itemprop="datePublished">2020-03-08</time>
</a>
      
<div class="article-category">
  <a class="article-category-link" href="/categories/web/">web</a>
</div>

    </div>
    

    
    
<div class="tocbot"></div>

    

    <div class="article-entry" itemprop="articleBody">
      
      
      
      <p>Webpack 是一个打包模块化 Javascript 的工具，在 webpack 里<strong>一切皆模块</strong>，通过 <strong><code>Loader</code></strong> 转换文件，通过 <strong><code>Plugin</code></strong> 注入钩子，最后输出由多个模块组合成的文件。webpack 专注于构建模块化项目。</p>
<span id="more"></span>

<p><strong><font color="red">以 webpack 5.x 为本文讲解版本。(篇幅太大，后续会再分篇详细论述)。</font></strong></p>
<p><img src="/images/web-webpack/webpack-slogan.png" alt="2021-road-map"></p>
<p><strong><font color="red">提前划重点：核心模块为 Loader 和 Plugin 两种开放接口。</font></strong></p>
<h2 id="入门篇"><a href="#入门篇" class="headerlink" title="入门篇"></a>入门篇</h2><p>老样子，先动手搭建基础款的 Webpack 项目：</p>
<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><ol>
<li>初始化项目：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir webpack-demo</span><br><span class="line">cd webpack-demo</span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>安装相关依赖：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">webpack 4.0 后需要同时安装 webpack-cli</span></span><br><span class="line">npm install webpack webpack-cli -D</span><br></pre></td></tr></table></figure>

<p>依赖说明：</p>
<ul>
<li><p>webpack: 属于<a href="https://webpack.docschina.org/">核心编译工具</a>。</p>
</li>
<li><p>webpack-cli: 由 webpack 抽取出来独立的 <strong>.bin 命令库</strong>，<a href="https://webpack.docschina.org/api/cli/">提供控制台命令</a>，接收参数，执行构建工作（npx webpack）。</p>
</li>
</ul>
<h3 id="配置选项"><a href="#配置选项" class="headerlink" title="配置选项"></a>配置选项</h3><ol start="3">
<li>生成 <code>webpack</code> 的配置文件 <code>webpack.config.js</code>：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch webpack.config.js</span><br></pre></td></tr></table></figure>

<details>
    <summary>配置文件内容（必须仔细浏览一遍）</summary>

<pre><code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO：在这里放上一个完整的 webpack 完整配置文件</span></span><br><span class="line"><span class="comment">/** <span class="doctag">@type</span> &#123;<span class="type">import(&#x27;webpack&#x27;.Configuration)</span>&#125; */</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ConsoleLogOnBuildWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;./plugin/ConsoleLogOnBuildWebpackPlugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Webpack 5 之后引入了 Asset Module 模型，自此我们只需要设置适当的 module.rules.type 配置即可，不需要为多媒体资源专门引入 Loader</span></span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [&#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&quot;babel-loader&quot;</span>],</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.less$/i</span>,</span><br><span class="line">            <span class="attr">include</span>: &#123;</span><br><span class="line">                <span class="attr">and</span>: [path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;./src/&#x27;</span>)]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">                <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&quot;less-loader&quot;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|jpg)$/</span>,</span><br><span class="line">            <span class="attr">use</span>: [</span><br><span class="line">                <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                        <span class="attr">limit</span>: <span class="number">1024</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">loader</span>: <span class="string">&#x27;image-webpack-loader&#x27;</span>,</span><br><span class="line">                    <span class="attr">options</span>: &#123;</span><br><span class="line">                    <span class="comment">// jpeg 压缩配置</span></span><br><span class="line">                    <span class="attr">mozjpeg</span>: &#123;</span><br><span class="line">                        <span class="attr">quality</span>: <span class="number">80</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.svg$/i</span>,</span><br><span class="line">            <span class="attr">use</span>: [<span class="string">&#x27;raw-loader&#x27;</span>],</span><br><span class="line">        &#125;],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ConsoleLogOnBuildWebpackPlugin</span>(),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123; <span class="attr">template</span>: <span class="string">&#x27;./src/index.html&#x27;</span> &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<blockquote>
<p>小技巧：在 vscode 中 <code>webpack.config.js</code> 文件开头添加注释 <code>/**@type &#123;import(&#39;webpack&#39;.Configuration)&#125; */</code>，会被标记为 webpack 配置文件，在输入时会有对应的提示选择项。</p>
</blockquote>
<h3 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h3><ol start="4">
<li>本处使用一个 import 引用的简单例子：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch src/index.js</span><br><span class="line">touch src/util.js</span><br></pre></td></tr></table></figure>

<details>
    <summary>src 文件内容</summary>

<pre><code><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** ------ src/index.js start ------ */</span></span><br><span class="line"><span class="keyword">import</span> util <span class="keyword">from</span> <span class="string">&#x27;./util&#x27;</span>;</span><br><span class="line"></span><br><span class="line">util.<span class="title function_">match</span>();</span><br><span class="line"><span class="comment">/** ------ src/index.js end ------ */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** ------ src/util.js start ------ */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="attr">match</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;match&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/** ------ src/util.js end ------ */</span></span><br></pre></td></tr></table></figure>
</code></pre>
</details>

<h3 id="构建运行"><a href="#构建运行" class="headerlink" title="构建运行"></a>构建运行</h3><p>将源代码文件编译构建生成最终产物 <code>dist/bundle.js</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx webpack</span><br></pre></td></tr></table></figure>

<p>webpack 自己实现了一套 <code>import</code>, 详细分析 <code>__webpack_require__</code>(TODO)</p>
<details>
  <summary>生成的 bundle.js 内容</summary>

  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******/</span> (<span class="function">() =&gt;</span> &#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"><span class="comment">/******/</span>  <span class="keyword">var</span> __webpack_modules__ = (&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> <span class="string">&quot;./src/index.js&quot;</span>:</span><br><span class="line"><span class="comment">/*!**********************!*\</span></span><br><span class="line"><span class="comment">!*** ./src/index.js ***!</span></span><br><span class="line"><span class="comment">\**********************/</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function">(<span class="params">__unused_webpack_module, __webpack_exports__, __webpack_require__</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span>(<span class="string">&quot;__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _util__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util */ \&quot;./src/util.js\&quot;);\n\r\n\r\n_util__WEBPACK_IMPORTED_MODULE_0__[\&quot;default\&quot;].match();\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/index.js?&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;),</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> <span class="string">&quot;./src/util.js&quot;</span>:</span><br><span class="line"><span class="comment">/*!*********************!*\</span></span><br><span class="line"><span class="comment">!*** ./src/util.js ***!</span></span><br><span class="line"><span class="comment">\*********************/</span></span><br><span class="line"><span class="comment">/***/</span> (<span class="function">(<span class="params">__unused_webpack_module, __webpack_exports__, __webpack_require__</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="built_in">eval</span>(<span class="string">&quot;__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, &#123;\n/* harmony export */   \&quot;default\&quot;: () =&gt; (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ &#125;);\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (&#123;\r\n    match: () =&gt; &#123;\r\n        // console.log(&#x27;match&#x27;)\r\n        return &#x27;match&#x27;\r\n    &#125;\r\n&#125;);\n\n//# sourceURL=webpack://webpack-demo/./src/util.js?&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/***/</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/******/</span>  &#125;);</span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="comment">// The module cache</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="keyword">var</span> __webpack_module_cache__ = &#123;&#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="comment">// The require function</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="keyword">function</span> <span class="title function_">__webpack_require__</span>(<span class="params">moduleId</span>) &#123;</span><br><span class="line"><span class="comment">/******/</span>   <span class="comment">// Check if module is in cache</span></span><br><span class="line"><span class="comment">/******/</span>   <span class="keyword">var</span> cachedModule = __webpack_module_cache__[moduleId];</span><br><span class="line"><span class="comment">/******/</span>   <span class="keyword">if</span> (cachedModule !== <span class="literal">undefined</span>) &#123;</span><br><span class="line"><span class="comment">/******/</span>    <span class="keyword">return</span> cachedModule.<span class="property">exports</span>;</span><br><span class="line"><span class="comment">/******/</span>   &#125;</span><br><span class="line"><span class="comment">/******/</span>   <span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line"><span class="comment">/******/</span>   <span class="keyword">var</span> <span class="variable language_">module</span> = __webpack_module_cache__[moduleId] = &#123;</span><br><span class="line"><span class="comment">/******/</span>    <span class="comment">// no module.id needed</span></span><br><span class="line"><span class="comment">/******/</span>    <span class="comment">// no module.loaded needed</span></span><br><span class="line"><span class="comment">/******/</span>    <span class="attr">exports</span>: &#123;&#125;</span><br><span class="line"><span class="comment">/******/</span>   &#125;;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>   <span class="comment">// Execute the module function</span></span><br><span class="line"><span class="comment">/******/</span>   __webpack_modules__[moduleId](<span class="variable language_">module</span>, <span class="variable language_">module</span>.<span class="property">exports</span>, __webpack_require__);</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>   <span class="comment">// Return the exports of the module</span></span><br><span class="line"><span class="comment">/******/</span>   <span class="keyword">return</span> <span class="variable language_">module</span>.<span class="property">exports</span>;</span><br><span class="line"><span class="comment">/******/</span>  &#125;</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="comment">/* webpack/runtime/define property getters */</span></span><br><span class="line"><span class="comment">/******/</span>  (<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">/******/</span>   <span class="comment">// define getter functions for harmony exports</span></span><br><span class="line"><span class="comment">/******/</span>   __webpack_require__.<span class="property">d</span> = <span class="function">(<span class="params"><span class="built_in">exports</span>, definition</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">/******/</span>    <span class="keyword">for</span>(<span class="keyword">var</span> key <span class="keyword">in</span> definition) &#123;</span><br><span class="line"><span class="comment">/******/</span>     <span class="keyword">if</span>(__webpack_require__.<span class="title function_">o</span>(definition, key) &amp;&amp; !__webpack_require__.<span class="title function_">o</span>(<span class="built_in">exports</span>, key)) &#123;</span><br><span class="line"><span class="comment">/******/</span>      <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="built_in">exports</span>, key, &#123; <span class="attr">enumerable</span>: <span class="literal">true</span>, <span class="attr">get</span>: definition[key] &#125;);</span><br><span class="line"><span class="comment">/******/</span>     &#125;</span><br><span class="line"><span class="comment">/******/</span>    &#125;</span><br><span class="line"><span class="comment">/******/</span>   &#125;;</span><br><span class="line"><span class="comment">/******/</span>  &#125;)();</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="comment">/* webpack/runtime/hasOwnProperty shorthand */</span></span><br><span class="line"><span class="comment">/******/</span>  (<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">/******/</span>   __webpack_require__.<span class="property">o</span> = <span class="function">(<span class="params">obj, prop</span>) =&gt;</span> (<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(obj, prop))</span><br><span class="line"><span class="comment">/******/</span>  &#125;)();</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="comment">/* webpack/runtime/make namespace object */</span></span><br><span class="line"><span class="comment">/******/</span>  (<span class="function">() =&gt;</span> &#123;</span><br><span class="line"><span class="comment">/******/</span>   <span class="comment">// define __esModule on exports</span></span><br><span class="line"><span class="comment">/******/</span>   __webpack_require__.<span class="property">r</span> = <span class="function">(<span class="params"><span class="built_in">exports</span></span>) =&gt;</span> &#123;</span><br><span class="line"><span class="comment">/******/</span>    <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="title class_">Symbol</span> !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="title class_">Symbol</span>.<span class="property">toStringTag</span>) &#123;</span><br><span class="line"><span class="comment">/******/</span>     <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="built_in">exports</span>, <span class="title class_">Symbol</span>.<span class="property">toStringTag</span>, &#123; <span class="attr">value</span>: <span class="string">&#x27;Module&#x27;</span> &#125;);</span><br><span class="line"><span class="comment">/******/</span>    &#125;</span><br><span class="line"><span class="comment">/******/</span>    <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(<span class="built_in">exports</span>, <span class="string">&#x27;__esModule&#x27;</span>, &#123; <span class="attr">value</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="comment">/******/</span>   &#125;;</span><br><span class="line"><span class="comment">/******/</span>  &#125;)();</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="comment">// startup</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="comment">// Load entry module and return exports</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="comment">// This entry module can&#x27;t be inlined because the eval devtool is used.</span></span><br><span class="line"><span class="comment">/******/</span>  <span class="keyword">var</span> __webpack_exports__ = <span class="title function_">__webpack_require__</span>(<span class="string">&quot;./src/index.js&quot;</span>);</span><br><span class="line"><span class="comment">/******/</span></span><br><span class="line"><span class="comment">/******/</span> &#125;)()</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
</details>

<p>基础项目的搭建和内容到此先告一段落，接下来就要开始涉及难懂的核心原理了。</p>
<h2 id="原理篇"><a href="#原理篇" class="headerlink" title="原理篇"></a>原理篇</h2><p>了解核心原理，首选边调试边查看的方式：</p>
<ol>
<li>在 <code>vscode</code> 编辑器中单独打开项目</li>
<li>新建 terminal，<strong>再新建 <code>JavaScript debug terminal</code></strong></li>
<li>在** <code>node_modules/webpack/lib/</code>** 目录的 <strong><code>webpack.js</code></strong> 和 <strong><code>WebpackOptionsApply.js</code></strong> 调试位置打上断点</li>
<li>终端运行 <code>npx webpack</code></li>
</ol>
<h3 id="核心流程图"><a href="#核心流程图" class="headerlink" title="核心流程图"></a>核心流程图</h3><p><img src="/images/web-webpack/webpack-core.png" alt="核心流程图"></p>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><table>
<thead>
<tr>
<th align="left">技术名词</th>
<th align="left">介绍</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Entry</td>
<td align="left">编译入口，webpack 编译的起点</td>
</tr>
<tr>
<td align="left">Compiler</td>
<td align="left">编译管理器，webpack 启动后会创建 compiler 对象，<strong>该对象一直存活直到结束退出</strong></td>
</tr>
<tr>
<td align="left">Compilation</td>
<td align="left">单次编辑过程的管理器，比如 watch &#x3D; true 时，运行过程中只有一个 compiler，<strong>但每次文件变更触发重新编译时，都会创建一个新的 compilation 对象</strong></td>
</tr>
<tr>
<td align="left">Dependence</td>
<td align="left">依赖对象，webpack 基于该类型记录模块间依赖关系</td>
</tr>
<tr>
<td align="left">Module</td>
<td align="left">webpack 内部所有资源都会以 module对象形式存在，所有关于资源的操作、转译、合并都是以 module为基本单位进行的</td>
</tr>
<tr>
<td align="left">Chunk</td>
<td align="left">编译完成准备输出时，webpack 会将module按特定的规则组织成一个一个的 chunk，<strong>这些 chunk 某种程度上跟最终输出一一对应</strong></td>
</tr>
<tr>
<td align="left">Loader</td>
<td align="left">资源内容转换器，其实就是实现从内容 A 转换 B 的转换器</td>
</tr>
<tr>
<td align="left">Plugin</td>
<td align="left">webpack构建过程中，会在特定的时机广播对应的事件，插件监听这些事件，在特定时间点介入编译过程</td>
</tr>
</tbody></table>
<h2 id="核心篇"><a href="#核心篇" class="headerlink" title="核心篇"></a>核心篇</h2><h3 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h3><p>介绍：</p>
<p>运行顺序：从右到左</p>
<h4 id="核心原理"><a href="#核心原理" class="headerlink" title="核心原理"></a>核心原理</h4><h4 id="常用-loader"><a href="#常用-loader" class="headerlink" title="常用 loader"></a>常用 loader</h4><table>
<thead>
<tr>
<th align="left">loader</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">vue-loader</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">style-loader</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">css-loader</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">scss-loader</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">postcss-loader</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">url-loader</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">babel-loader</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">posthtml-loader</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">ts-loader</td>
<td align="center"></td>
</tr>
</tbody></table>
<h4 id="编写-loader"><a href="#编写-loader" class="headerlink" title="编写 loader"></a>编写 loader</h4><h3 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h3><p>介绍：</p>
<h4 id="核心原理-1"><a href="#核心原理-1" class="headerlink" title="核心原理"></a>核心原理</h4><p>关键：tap &amp;&amp; call</p>
<h4 id="tapable"><a href="#tapable" class="headerlink" title="tapable"></a>tapable</h4><p>地址：<a href="https://github.com/webpack/tapable/">tapable</a>，dd</p>
<h4 id="hook"><a href="#hook" class="headerlink" title="hook"></a>hook</h4><h3 id="常用-plugin"><a href="#常用-plugin" class="headerlink" title="常用 plugin"></a>常用 plugin</h3><table>
<thead>
<tr>
<th align="left">plugin</th>
<th align="center">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">SplitChunksPlugin</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">TextExtractPlugin</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">DllPlugin</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">ImageMinimizerWebpackPlugin</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">TerserWebpackPlugin</td>
<td align="center"></td>
</tr>
</tbody></table>
<h3 id="编写-plugin"><a href="#编写-plugin" class="headerlink" title="编写 plugin"></a>编写 plugin</h3><h2 id="高级特性"><a href="#高级特性" class="headerlink" title="高级特性"></a>高级特性</h2><h3 id="hmr"><a href="#hmr" class="headerlink" title="hmr"></a>hmr</h3><h3 id="tree-shaking"><a href="#tree-shaking" class="headerlink" title="tree-shaking"></a>tree-shaking</h3><blockquote>
<p>你可以将应用程序想象成一棵树。绿色表示实际用到的 source code(源码) 和 library(库)，是树上活的树叶。灰色表示未引用代码，是秋天树上枯萎的树叶。为了除去死去的树叶，你必须摇动这棵树，使它们落下。</p>
</blockquote>
<p>现象：构建时会移除 JavaScript 上下文中的**未引用代码(dead-code)**。</p>
<p>关联插件：<code>TerserWebpackPlugin</code></p>
<p>前提：</p>
<ul>
<li><strong>使用 ES2015 模块语法（即 <code>import</code> 和 <code>export</code>）</strong>;</li>
<li>在项目的 package.json 文件中，添加 “sideEffects” 属性;</li>
<li>需要将 <code>webpack.config.js</code> 中的 <code>mode</code> 配置选项设置为 <code>production</code>。</li>
</ul>
<p>和 <code>babel-loader</code> 的关系???</p>
<h3 id="source-map"><a href="#source-map" class="headerlink" title="source-map"></a>source-map</h3><p><code>source map</code> 实质上是一个 <strong><code>JSON</code> 描述文件</strong>，里面存储了代码打包转换后的位置信息，维护了打包前后的代码映射关系。</p>
<h4 id="环境应用"><a href="#环境应用" class="headerlink" title="环境应用"></a>环境应用</h4><p>生成环境：<code>none</code></p>
<p>开发环境：<code>source-map</code></p>
<h4 id="配置参考"><a href="#配置参考" class="headerlink" title="配置参考"></a>配置参考</h4><table>
<thead>
<tr>
<th align="left">关键字</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">source-map</td>
<td align="center">生成 sourcemap 文件，可以配置 inline，会以 dataURL 的方式内联，可以配置 hidden，只生成 sourcemap，不和生成的文件关联</td>
</tr>
<tr>
<td align="left">eval</td>
<td align="center">浏览器 devtool 支持通过 sourceUrl 来把 eval 的内容单独生成文件，还可以进一步通过 sourceMappingUrl 来映射回源码，webpack 利用这个特性来简化了 sourcemap 的处理，可以直接从模块开始映射，不用从 bundle 级别</td>
</tr>
<tr>
<td align="left">cheap</td>
<td align="center">只映射到源代码的某一行，不精确到列，可以提升 sourcemap 生成速度</td>
</tr>
<tr>
<td align="left">module</td>
<td align="center">sourcemap 生成时会关联每一步 loader 生成的 sourcemap，配合 sourcemap-loader 可以映射回最初的源码</td>
</tr>
<tr>
<td align="left">inline</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">hidden</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">nosources</td>
<td align="center">不生成 sourceContent 内容，可以减小 sourcemap 文件的大小</td>
</tr>
</tbody></table>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><h4 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h4><h3 id="code-splitting"><a href="#code-splitting" class="headerlink" title="code-splitting"></a>code-splitting</h3><p>参考资料：</p>
<p>[1] <a href="https://www.webpackjs.com/">Webpack 官网</a><br>
[2] <a href="https://gitmind.cn/app/docs/m1foeg1o">Webpack 5 知识体系</a><br>
[2] <a href="https://mp.weixin.qq.com/s/SbJNbSVzSPSKBe2YStn2Zw">[万字总结] 一文吃透 Webpack 核心原理</a><br></p>
<p><a href="https://mp.weixin.qq.com/s/E26Ll8-VGo4rnGeHdgNAVQ">https://mp.weixin.qq.com/s/E26Ll8-VGo4rnGeHdgNAVQ</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://zeuscoder.github.io/2020/03/08/web-webpack/" data-id="clvyv2sv700244bc990oj8j5h" class="article-share-link">
        分享
      </a>
      
<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PROJECT/" rel="tag">PROJECT</a></li></ul>

    </footer>

  </div>

  
  
<nav class="article-nav">
  
  <a href="/2020/03/15/js-design-pattern/" class="article-nav-link">
    <strong class="article-nav-caption">前一篇</strong>
    <div class="article-nav-title">
      
      JS：潜伏的设计模式
      
    </div>
  </a>
  
  
  <a href="/2019/07/23/js-vue/" class="article-nav-link">
    <strong class="article-nav-caption">后一篇</strong>
    <div class="article-nav-title">JS：浅析 Vue</div>
  </a>
  
</nav>

  

  
  
  
  

</article>
</section>
    <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
  <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
  <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>zeus の blog &copy; 2024</li>
      
        <li></li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/zeus.png" alt="zeus の blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">相册</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/js/wrapImage.js"></script>


<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/copybtn.js"></script>





<script src="/js/tocbot.min.js"></script>

<script>
  // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
  tocbot.init({
    tocSelector: '.tocbot',
    contentSelector: '.article-entry',
    headingSelector: 'h1, h2, h3, h4, h5, h6',
    hasInnerContainers: true,
    scrollSmooth: true,
    positionFixedSelector: '.tocbot',
    positionFixedClass: 'is-position-fixed',
    fixedSidebarOffset: 'auto',
  });
</script>



<script src="/js/ocean.js"></script>

</body>

</html>